
## z3_robot
### Description

> I made a robot that can only communicate with "z3". He locked himself and now he is asking me for a password ! 
>
> `z 3 w a v e s` 
>
> Creator : Nofix


### Attachment

[z3_robot](https://cdn.jsdelivr.net/gh/TaQini/ctf@master/SharkyCTF-2020/re/z3_robot/z3_robot)

### Analysis

```c
_BOOL8 __fastcall check_flag(char *a1){
  return (a1[20] ^ 0x2B) == a1[7]
      && a1[21] - a1[3] == -20
      && !(a1[2] >> 6)
      && a1[13] == 116
      && 4 * a1[11] == 380
      && a1[7] >> a1[17] % 8 == 5
      && (a1[6] ^ 0x53) == a1[14]
      && a1[8] == 122
      && a1[5] << a1[9] % 8 == 392
      && a1[16] - a1[7] == 20
      && a1[7] << a1[23] % 8 == 190
      && a1[2] - a1[7] == -43
      && a1[21] == 95
      && (a1[2] ^ 0x47) == a1[3]
      && *a1 == 99
      && a1[13] == 116
      && (a1[20] & 0x45) == 68
      && (a1[8] & 0x15) == 16
      && a1[12] == 95
      && a1[4] >> 4 == 7
      && a1[13] == 116
      && *a1 >> *a1 % 8 == 12
      && a1[10] == 95
      && (a1[8] & 0xAC) == 40
      && a1[16] == 115
      && (a1[22] & 0x1D) == 24
      && a1[9] == 51
      && a1[5] == 49
      && 4 * a1[19] == 456
      && a1[20] >> 6 == 1
      && a1[7] >> 1 == 47
      && a1[1] == 108
      && a1[3] >> 4 == 7
      && (a1[19] & 0x49) == 64
      && a1[4] == 115
      && (a1[2] & a1[11]) == 20
      && *a1 == 99
      && a1[4] + a1[5] == 164
      && a1[15] << 6 == 6080
      && (a1[10] ^ 0x2B) == a1[17]
      && (a1[12] ^ 0x2C) == a1[4]
      && a1[19] - a1[21] == 19
      && a1[12] == 95
      && a1[15] >> 1 == 47
      && a1[19] == 114
      && a1[17] + a1[18] == 168
      && a1[22] == 58
      && (a1[23] & a1[21]) == 9
      && a1[6] << a1[19] % 8 == 396
      && a1[3] + a1[7] == 210
      && (a1[22] & 0xED) == 40
      && (a1[12] & 0xAC) == 12
      && (a1[18] ^ 0x6B) == a1[15]
      && (a1[16] & 0x7A) == 114
      && (*a1 & 0x39) == 33
      && (a1[6] ^ 0x3C) == a1[21]
      && a1[20] == 116
      && a1[19] == 114
      && a1[12] == 95
      && a1[2] == 52
      && a1[23] == 41
      && a1[10] == 95
      && (a1[22] & a1[9]) == 50
      && a1[3] + a1[2] == 167
      && a1[17] - a1[14] == 68
      && a1[21] == 95
      && (a1[19] ^ 0x2D) == a1[10]
      && 4 * a1[12] == 380
      && a1[6] & 0x40
      && (a1[12] & a1[22]) == 26
      && a1[7] << a1[19] % 8 == 380
      && (a1[20] ^ 0x4E) == a1[22]
      && a1[6] == 99
      && a1[12] == a1[7]
      && a1[19] - a1[13] == -2
      && a1[14] >> 4 == 3
      && (a1[12] & 0x38) == 24
      && a1[8] << a1[10] % 8 == 15616
      && a1[20] == 116
      && a1[6] >> a1[22] % 8 == 24
      && a1[22] - a1[5] == 9
      && a1[7] << a1[22] % 8 == 380
      && a1[22] == 58
      && a1[16] == 115
      && (a1[23] ^ 0x1D) == a1[18]
      && a1[23] + a1[14] == 89
      && (a1[5] & a1[2]) == 48
      && (a1[15] & 0x9F) == 31
      && a1[4] == 115
      && (a1[23] ^ 0x4A) == *a1
      && (a1[6] ^ 0x3C) == a1[11];
}
```

### Solution

```python
from z3 import *

x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23 = BitVecs("x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12 x13 x14 x15 x16 x17 x18 x19 x20 x21 x22 x23",8)

x=Solver()


x.add( (x20 ^ 43) == x7 )
x.add( (x21 - x3)  == -20 )
x.add( (x2 >> 222 % 8) == 0 )
x.add( (x13 + 87) == 203 )
x.add( (x11 << 82 % 8) == 380 )
x.add( (x7 >> x17 % 8) == 5 )
x.add( (x6 ^ 83) == x14 )
x.add( (x8 - 63) == 59 )
x.add( (x5 << x9 % 8) == 392 )
x.add( (x16 - x7)  == 20 )
x.add( (x7 << x23 % 8) == 190 )
x.add( (x2 - x7)  == -43 )
x.add( (x21 - 131) == -36 )
x.add( (x2 ^ 71) == x3 )
x.add( (x0 + 208) == 307 )
x.add( (x13 << 64 % 8) == 116 )
x.add( (x20 & 69) == 68 )
x.add( (x8 & 21) == 16 )
x.add( (x12 - 116) == -21 )
x.add( (x4 >> 204 % 8) == 7 )
x.add( (x13 ^ 71) == 51 )
x.add( (x0 >> x0 % 8) == 12 )
x.add( (x10 ^ 243) == 172 )
x.add( (x8 & 172) == 40 )
x.add( (x16 + 40) == 155 )
x.add( (x22 & 29) == 24 )
x.add( (x9 + 39) == 90 )
x.add( (x5 - 71) == -22 )
x.add( (x19 << 194 % 8) == 456 )
x.add( (x20 >> 46 % 8) == 1 )
x.add( (x7 >> 121 % 8) == 47 )
x.add( (x1 + 232) == 340 )
x.add( (x3 >> 244 % 8) == 7 )
x.add( (x19 & 73) == 64 )
x.add( (x4 ^ 124) == 15 )
x.add( (x2 & x11) == 20 )
x.add( (x0 & x0) == 99 )
x.add( (x4 + x5)  == 164 )
x.add( (x15 << 30 % 8) == 6080 )
x.add( (x10 ^ 43) == x17 )
x.add( (x12 ^ 44) == x4 )
x.add( (x19 - x21)  == 19 )
x.add( (x12 - 210) == -115 )
x.add( (x12 - 71) == 24 )
x.add( (x15 >> 193 % 8) == 47 )
x.add( (x19 - 103) == 11 )
x.add( (x17 + x18)  == 168 )
x.add( (x22 ^ 78) == 116 )
x.add( (x23 & x21) == 9 )
x.add( (x6 << x19 % 8) == 396 )
x.add( (x3 + x7)  == 210 )
x.add( (x22 & 237) == 40 )
x.add( (x12 & 172) == 12 )
x.add( (x18 ^ 107) == x15 )
x.add( (x16 & 122) == 114 )
x.add( (x0 & 57) == 33 )
x.add( (x6 ^ 60) == x21 )
x.add( (x20 >> 96 % 8) == 116 )
x.add( (x19 + 194) == 308 )
x.add( (x12 << 16 % 8) == 95 )
x.add( (x2 ^ 206) == 250 )
x.add( (x23 ^ 238) == 199 )
x.add( (x10 << 40 % 8) == 95 )
x.add( (x22 & x9) == 50 )
x.add( (x3 + x2)  == 167 )
x.add( (x17 - x14)  == 68 )
x.add( (x21 + 112) == 207 )
x.add( (x19 ^ 45) == x10 )
x.add( (x12 << 2 % 8) == 380 )
x.add( (x6 & 64) == 64 )
x.add( (x12 & x22) == 26 )
x.add( (x7 << x19 % 8) == 380 )
x.add( (x4 ^ 0) == x4 )
x.add( (x20 ^ 78) == x22 )
x.add( (x6 ^ 229) == 134 )
x.add( (x12 - x7)  == 0 )
x.add( (x19 - x13)  == -2 )
x.add( (x14 >> 212 % 8) == 3 )
x.add( (x12 & 56) == 24 )
x.add( (x8 << x10 % 8) == 15616 )
x.add( (x20 ^ 98) == 22 )
x.add( (x6 >> x22 % 8) == 24 )
x.add( (x22 - x5)  == 9 )
x.add( (x7 << x22 % 8) == 380 )
x.add( (x22 - 153) == -95 )
x.add( (x16 + 3) == 118 )
x.add( (x23 ^ 29) == x18 )
x.add( (x23 + x14)  == 89 )
x.add( (x5 & x2) == 48 )
x.add( (x15 & 159) == 31 )
x.add( (x4 - 2) == 113 )
x.add( (x23 ^ 74) == x0 )
x.add( (x6 ^ 60) == x11)

x.check()
x.model()

l=[x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23]

flag = ''.join([chr(x.model()[i].as_long()) for i in l ])

print "shkCTF{%s}"%flag

# flag: shkCTF{cl4ss1c_z3___t0_st4rt_:)}
```

### More

you can download all files from my [github](https://github.com/TaQini/ctf/tree/master/SharkyCTF-2020/re/z3_robot) 


