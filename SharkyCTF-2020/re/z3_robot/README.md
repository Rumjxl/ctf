
## z3_robot
### Description

> I made a robot that can only communicate with "z3". He locked himself and now he is asking me for a password ! 
>
> `z 3 w a v e s` 
>
> Creator : Nofix


### Attachment

[z3_robot](https://cdn.jsdelivr.net/gh/TaQini/ctf@master/SharkyCTF-2020/re/z3_robot/z3_robot)

### Analysis

```c
_BOOL8 __fastcall check_flag(char *a1){
  return (a1[20] ^ 0x2B) == a1[7]
      && a1[21] - a1[3] == -20
      && !(a1[2] >> 6)
      && a1[13] == 116
      && 4 * a1[11] == 380
      && a1[7] >> a1[17] % 8 == 5
      && (a1[6] ^ 0x53) == a1[14]
      && a1[8] == 122
      && a1[5] << a1[9] % 8 == 392
      && a1[16] - a1[7] == 20
      && a1[7] << a1[23] % 8 == 190
      && a1[2] - a1[7] == -43
      && a1[21] == 95
      && (a1[2] ^ 0x47) == a1[3]
      && *a1 == 99
      && a1[13] == 116
      && (a1[20] & 0x45) == 68
      && (a1[8] & 0x15) == 16
      && a1[12] == 95
      && a1[4] >> 4 == 7
      && a1[13] == 116
      && *a1 >> *a1 % 8 == 12
      && a1[10] == 95
      && (a1[8] & 0xAC) == 40
      && a1[16] == 115
      && (a1[22] & 0x1D) == 24
      && a1[9] == 51
      && a1[5] == 49
      && 4 * a1[19] == 456
      && a1[20] >> 6 == 1
      && a1[7] >> 1 == 47
      && a1[1] == 108
      && a1[3] >> 4 == 7
      && (a1[19] & 0x49) == 64
      && a1[4] == 115
      && (a1[2] & a1[11]) == 20
      && *a1 == 99
      && a1[4] + a1[5] == 164
      && a1[15] << 6 == 6080
      && (a1[10] ^ 0x2B) == a1[17]
      && (a1[12] ^ 0x2C) == a1[4]
      && a1[19] - a1[21] == 19
      && a1[12] == 95
      && a1[15] >> 1 == 47
      && a1[19] == 114
      && a1[17] + a1[18] == 168
      && a1[22] == 58
      && (a1[23] & a1[21]) == 9
      && a1[6] << a1[19] % 8 == 396
      && a1[3] + a1[7] == 210
      && (a1[22] & 0xED) == 40
      && (a1[12] & 0xAC) == 12
      && (a1[18] ^ 0x6B) == a1[15]
      && (a1[16] & 0x7A) == 114
      && (*a1 & 0x39) == 33
      && (a1[6] ^ 0x3C) == a1[21]
      && a1[20] == 116
      && a1[19] == 114
      && a1[12] == 95
      && a1[2] == 52
      && a1[23] == 41
      && a1[10] == 95
      && (a1[22] & a1[9]) == 50
      && a1[3] + a1[2] == 167
      && a1[17] - a1[14] == 68
      && a1[21] == 95
      && (a1[19] ^ 0x2D) == a1[10]
      && 4 * a1[12] == 380
      && a1[6] & 0x40
      && (a1[12] & a1[22]) == 26
      && a1[7] << a1[19] % 8 == 380
      && (a1[20] ^ 0x4E) == a1[22]
      && a1[6] == 99
      && a1[12] == a1[7]
      && a1[19] - a1[13] == -2
      && a1[14] >> 4 == 3
      && (a1[12] & 0x38) == 24
      && a1[8] << a1[10] % 8 == 15616
      && a1[20] == 116
      && a1[6] >> a1[22] % 8 == 24
      && a1[22] - a1[5] == 9
      && a1[7] << a1[22] % 8 == 380
      && a1[22] == 58
      && a1[16] == 115
      && (a1[23] ^ 0x1D) == a1[18]
      && a1[23] + a1[14] == 89
      && (a1[5] & a1[2]) == 48
      && (a1[15] & 0x9F) == 31
      && a1[4] == 115
      && (a1[23] ^ 0x4A) == *a1
      && (a1[6] ^ 0x3C) == a1[11];
}
```

### Solution

```python
from z3 import *
x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,x10,x11,x12,x13,x14,x15,x16,x17,x18,x19,x20,x21,x22,x23 = BitVecs("x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 x10 x11 x12 x13 x14 x15 x16 x17 x18 x19 x20 x21 x22 x23",8)
x=Solver()
x.add(x19 - x13 == -2)
x.add(x14 >> 4 == 3)
x.add((x12 & 0x38) == 24)
x.add(x8 << x10 % 8 == 15616)
x.add(x20 == 116)
x.add(x6 >> x22 % 8 == 24)
x.add(x22 - x5 == 9)
x.add(x7 << x22 % 8 == 380)
x.add(x22 == 58)
x.add(x16 == 115)
x.add((x23 ^ 0x1D) == x18)
x.add(x23 + x14 == 89)
x.add((x5 & x2) == 48)
x.add((x15 & 0x9F) == 31)
x.add(x4 == 115)
x.add((x23 ^ 0x4A) == x0)
x.add((x6 ^ 0x3C) == x11)
x.check()
x.model()
# [x11 = 95,
#  x7 = 95,
#  x6 = 99,
#  x14 = 48,
#  x3 = 115,
#  x23 = 41,
#  x2 = 52,
#  x20 = 116,
#  x15 = 95,
#  x22 = 58,
#  x18 = 52,
#  x19 = 114,
#  x17 = 116,
#  x4 = 115,
#  x1 = 108,
#  x5 = 49,
#  x9 = 51,
#  x16 = 115,
#  x10 = 95,
#  x12 = 95,
#  x0 = 99,
#  x21 = 95,
#  x8 = 122,
#  x13 = 116]

l=[99,108, 52,115,115,49,99,95,122,51,95,95,95,116,48,95,115,116,52,114,116,95,58,41]

flag = ''.join([chr(i) for i in l])

# flag: shkCTF{cl4ss1c_z3___t0_st4rt_:)}
```


### More

you can download all files from my [github](https://github.com/TaQini/ctf/tree/master/SharkyCTF-2020/re/z3_robot) 


